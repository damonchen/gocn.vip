<!--
   _   _                      _                 _
  | | | |                    | |               | |
  | |_| | ___  _ __ ___   ___| | __ _ _ __   __| |
  |  _  |/ _ \| '_ ` _ \ / _ \ |/ _` | '_ \ / _` |
  | | | | (_) | | | | | |  __/ | (_| | | | | (_| |
  \_| |_/\___/|_| |_| |_|\___|_|\__,_|_| |_|\__,_|
  ------------------------------------------------
                          https://gethomeland.com

  - Ruby:  2.6.5-p114
  - Rails: 6.0.2.1
  - Homeland: 3.3.0
-->
<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>åœ¨ Go ä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡ Â· GopherChina</title>
  <meta name="apple-mobile-web-app-capable" content="no">
  <meta content='True' name='HandheldFriendly' />
  <link rel="alternate" type="application/rss+xml" title="è®¢é˜…æœ€æ–°å¸–" href="https://gocn.vip/topics/feed" />
  <link rel="stylesheet" media="screen" href="/assets/front-63d390ab2ab1f90563a309a2c6b335e72140ccad53db766b199ae3ede1df2534.css" data-turbolinks-track="reload" />
  
  
  <meta name="action-cable-url" content="/cable" />
  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="nY940wc8rmzG9PG7m51qV3X/z9nPf46/qg6ErdyF/4IKXm577PiA2AO9eti/PTHP7I2cKz64a19IWJQro+ghQg==" />
  <link rel="shortcut icon" type="image/png" href="/uploads/favicon.ico"/>
<link rel="apple-touch-icon" sizes="180x180" href="/uploads/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon-16x16.png">
<meta name="keywords" content="GopherChina,Go,Golang,Goè¯­è¨€,Goè®ºå›,Goä¸‹è½½,åŸåˆ›åˆ†äº«,Goå›¾ä¹¦,å¼€æºé¡¹ç›®">
<meta name="description" content="GopherChinaä¸“æ³¨äºä¸º Goè¯­è¨€å¼€å‘è€…çš„æŠ€æœ¯æå‡ï¼Œç”¨æˆ·æ•°é‡ã€æ´»è·ƒåº¦å’Œå†…å®¹çƒ­åº¦å‡å±…å›½å†…é¦–ä½ã€‚åŠæ—¶æ¨é€å®˜æ–¹æœ€æ–°èµ„è®¯ã€ç²¾é€‰ä¼˜è´¨è¯­è¨€å­¦ä¹ æ–‡æ¡£ã€ä¼ é€’ä¸€æ‰‹æ·±å·¥ç¨‹å®è·µç»éªŒï¼Œå¹¶ä¸”ä¼šå®šæœŸä¸¾åŠçº¿ä¸‹meetupã€å³°ä¼šã€åŸ¹è®­åŠèµ›äº‹ï¼Œæ—¨åœ¨æ‰“é€ å…¨æ–¹ä½æƒå¨çš„ Go ç¤¾åŒºã€‚">

  <script src="/assets/app-6c6671b9d1c9418af193d414c1697d346f27a0ba7ab4a510ac051d1647e48087.js" data-turbolinks-track="reload"></script>
  
</head>
<body class="page-topics" data-controller-name="topics">
  <div class="header navbar navbar-expand flex-md-row bd-navbar">
    <div class="container d-sm-flex">
      <div class="navbar-header d-none d-md-flex" id="navbar-header" data-turbolinks-permanent>
        <a href="/" class="navbar-brand"><b><img src="/uploads/logo.png" height="30px"></b></a>
      </div>
      <div class="navbar-nav-scroll">
              <div class="navbar-topic-title">
        <a href="#" class="topic-title pull-left" title="åœ¨ Go ä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡" data-type="top">
          <h1><span class="node">è¯‘æ–‡</span> <span class="title">åœ¨ Go ä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡</span></h1>
        </a>
      </div>

        <ul id="main-nav-menu" class="navbar-nav d-flex">
  <li class="nav-item"><a class="nav-link active" href="/topics">ç¤¾åŒº</a></li><li class="nav-item"><a class="nav-link" href="/jobs">æ‹›è˜</a></li><li class="nav-item"><a class="nav-link" href="/wiki">Wiki</a></li><li class="nav-item"><a class="nav-link" href="/sites">é…·ç«™</a></li>
  <ul id="main-nav-menu" class="navbar-nav d-flex">
<li class="nav-item"><a class="nav-link" href="/teams">ç»„ç»‡</a></li>
<li class="nav-item"><a class="nav-link" href="https://golang.google.cn/dl/" target="blank">ä¸‹è½½</a></li>
<!--<li class="nav-item"><a class="nav-link" href="/wiki/training">åŸ¹è®­</a></li>-->
<li class="nav-item"><a class="nav-link" href="/wiki/goproxy">Go Proxyé•œåƒ</a></li>
</ul>
</ul>

      </div>
      <div class="ml-auto d-md-flex">
        <form class="navbar-form d-none d-lg-flex mr-2 form-search active" action="/search" method="GET">
          <i class="fa btn-search fa-search"></i>
          <input class="form-control" name="q" type="text" value="" placeholder="æœç´¢æœ¬ç«™å†…å®¹" />
        </form>
        <ul class="nav navbar-nav user-bar align-items-center justify-content-end">

    <li class="nav-item"><a class="nav-link" href="/account/sign_up">æ³¨å†Œ</a></li>

    <li class="nav-item"><a class="nav-link" href="/account/sign_in">ç™»å½•</a></li>
</ul>



      </div>
    </div>
  </div>

  

  <div id="main" class="main-container container">
    
    <div class="row">
  <div class="col-md-9">
    <div class="topic-detail card">
      <div class="card-header media clearfix">
  <div class="media-body">
    <h1 class="media-heading">
      <a class="node" href="/topics/node39">è¯‘æ–‡</a>
      <span class="title">
        åœ¨ Go ä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡
      </span>
      
    </h1>
    <div class="info">
      <a data-author="true" class="user-name" data-name="Kevin" href="/kevin">kevin</a>
      <span class="hidden-mobile">
      </span>
       Â·
      <abbr class="timeago" title="2020-02-16T21:57:45+08:00">2020å¹´02æœˆ16æ—¥</abbr>
      </span>
       Â·
      363 æ¬¡é˜…è¯»
    </div>
  </div>
  <div class="avatar media-right">
    <a title="kevin (Kevin)" href="/kevin"><img class="media-object avatar-48" src="https://gocn.oss-cn-shanghai.aliyuncs.com/user/avatar/238/32f2aa.jpg?x-oss-process=image/resize,w_96,h_96,m_fill" /></a>
  </div>
</div>

        <div class="label-awesome">
          <i class="fa fa-diamond awesome"></i> æœ¬å¸–å·²è¢«è®¾ä¸ºç²¾åå¸–ï¼
        </div>
      <div class="card-body markdown markdown-toc">
        
        <p>æœ¬æ–‡çš„ç›®çš„æ˜¯å¸®åŠ©æ¼”ç¤ºå½“åº”ç”¨ç¨‹åºéšç€æ—¶é—´ä¸æ–­æ¨ç§»ä¸æ–­æ¼”åŒ–æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡å¸®æˆ‘ä»¬è§£å†³å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä¸€ä¸ªçç¢çš„é¡¹ç›®ç ”ç©¶é¡¹ç›®æ˜¯å¦‚ä½•éšç€æ—¶é—´ä¸€æ­¥æ­¥æ¼”åŒ–çš„ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ï¼Œç¤ºä¾‹ä»£ç å¹¶ä¸èƒ½å¤Ÿç›´æ¥ç¼–è¯‘ï¼Œç”šè‡³æœ‰äº›å¯¼å…¥ä»¥æ¥æ²¡æœ‰å…¨éƒ¨åˆ—å‡ºã€‚è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½ å¯ä»¥éšæ—¶ä¸æˆ‘è”ç³»ï¼Œæˆ‘ä»¬å°†å¯¹é—®é¢˜è¿›è¡Œè°ƒæ•´æˆ–è€…ä½ çš„é—®é¢˜åŠæ—¶è§£ç­”ï¼ˆå¦‚æœå¯ä»¥çš„è¯ï¼‰ã€‚</p>

<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„èƒŒæ™¯ã€‚æƒ³è±¡ä¸€ä¸‹ä½ åœ¨å·¥ä½œï¼Œè€æ¿è¦æ±‚ä½ åˆ›å»ºä¸€ç§é€šè¿‡ GitHub API å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯çš„æ–¹æ³•ã€‚å…·ä½“ä¸Šè¯´ï¼Œä½ éœ€è¦åˆ©ç”¨ç”¨æˆ·ä¸ªäººè®¿é—®ä»¤ç‰Œï¼ŒæŸ¥æ‰¾è¯¥ç”¨æˆ·åŠå…¶æ‰€æœ‰ç»„ç»‡ã€‚ è¿™æ ·ï¼Œä½ ä»¥åå°±å¯ä»¥æ ¹æ®ä»–ä»¬æ‰€å±çš„ç»„ç»‡æ¥é™åˆ¶ä»–ä»¬çš„è®¿é—®ã€‚</p>

<p><em>æ³¨æ„ï¼šæˆ‘ä»¬è¿™é‡Œä½¿ç”¨è®¿é—®ä»¤ç‰Œæ¥ç®€åŒ–ç¤ºä¾‹ã€‚</em></p>

<p>è¿™å¬èµ·æ¥å¾ˆå®¹æ˜“ï¼Œæ‰€ä»¥ä½ å¯åŠ¨ç¼–è¾‘å™¨å¹¶å®ç°æä¾›æ­¤åŠŸèƒ½çš„<code>github</code>åŒ…ã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">github</span>

<span class="k">type</span> <span class="n">User</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">ID</span>    <span class="kt">string</span>
  <span class="n">Email</span> <span class="kt">string</span>
  <span class="n">OrgIDs</span> <span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">Client</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Key</span>   <span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">Client</span><span class="p">)</span> <span class="n">User</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// ä¸Github APIè¿›è¡Œäº¤äº’ï¼Œå¹¶è¿”å›ç”¨æˆ·ã€‚å¦‚æœä»–ä»¬åœ¨ä¸€ä¸ªç»„ç»‡ä¸­ï¼Œè¿”å›ç»„ç»‡çš„c.OrgID</span>
<span class="p">}</span>
</code></pre> 
<p><em>æ³¨æ„ï¼šè¿™é‡Œä¸æ˜¯ä½¿ç”¨çœŸå®çš„ Github API - è¿™åªæ˜¯ä¸€ä¸ªæ¼”ç¤ºä¾‹å­ã€‚</em></p>

<p>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦ç»™<code>github</code>åŒ…ç¼–å†™ä¸€äº›ä¸­é—´ä»¶ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨éœ€è¦ä¿æŠ¤çš„ HTTP handler ä¸­ä½¿ç”¨è¿™ä¸ªåŒ…ã€‚åœ¨ä¸­é—´ä»¶ä¸­ï¼Œä½ é€šè¿‡å¤´éƒ¨ä¸­çš„ basic auth ä¸­è·å¾—ç”¨æˆ·çš„è®¿é—®ä»¤ç‰Œï¼Œç„¶åè°ƒç”¨ Github çš„ä»£ç æŸ¥æ‰¾ç”¨æˆ·ï¼Œæ£€æŸ¥ä»–ä»¬æ˜¯å¦æ˜¯æ‰€æä¾›ç»„ç»‡çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åç›¸åº”åœ°æˆäºˆæƒé™æˆ–æ‹’ç»è®¿é—®ã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">mw</span>

<span class="k">func</span> <span class="n">AuthMiddleware</span><span class="p">(</span><span class="n">client</span> <span class="o">*</span><span class="n">github</span><span class="o">.</span><span class="n">Client</span><span class="p">,</span> <span class="n">reqOrgID</span> <span class="kt">string</span><span class="p">,</span> <span class="n">next</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span><span class="p">)</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HandlerFunc</span><span class="p">(</span><span class="k">func</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">token</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">BasicAuth</span><span class="p">()</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">ok</span> <span class="p">{</span>
      <span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="err">â€œ</span><span class="n">Unauthorized</span><span class="err">â€</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusUnauthorized</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="n">user</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">User</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="err">â€œ</span><span class="n">Unauthorized</span><span class="err">â€</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusUnauthorized</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="n">permit</span> <span class="o">:=</span> <span class="no">false</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">orgID</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">user</span><span class="o">.</span><span class="n">OrgIDs</span> <span class="p">{</span>
      <span class="k">if</span> <span class="n">orgId</span> <span class="o">==</span> <span class="n">reqOrgID</span> <span class="p">{</span>
        <span class="n">permit</span> <span class="o">=</span> <span class="no">true</span>
        <span class="k">break</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">permit</span> <span class="p">{</span>
      <span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="err">â€œ</span><span class="n">Unauthorized</span><span class="err">â€</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusUnauthorized</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="c">// ç”¨æˆ·å·²è®¤è¯ï¼Œæ”¾ä»–ä»¬è¿›æ¥</span>
    <span class="n">next</span><span class="o">.</span><span class="n">ServeHTTP</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre> 
<p>ä½ å°†è¿™äº›ä»£ç ç»™ä½ çš„åŒäº‹çœ‹ï¼Œä»–ä»¬æ‹…å¿ƒç¼ºä¹æµ‹è¯•ã€‚å…·ä½“çš„è¯´ï¼Œæ²¡æœ‰ä¸€ç§æ–¹æ³•èƒ½å¤ŸéªŒè¯<code>AuthMiddleware</code>èƒ½å¦æŒ‰ç…§é¢„æœŸå·¥ä½œã€‚â€œæ²¡æœ‰é—®é¢˜â€ï¼Œä½ è¯´ï¼Œâ€œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ interface ä¿è¯æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„æµ‹è¯•å®ƒï¼â€</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">mw</span>

<span class="k">type</span> <span class="n">UserService</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">User</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">github</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">AuthMiddleware</span><span class="p">(</span><span class="n">us</span> <span class="n">UserService</span><span class="p">,</span> <span class="n">reqOrgID</span> <span class="kt">string</span><span class="p">,</span> <span class="n">next</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span><span class="p">)</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HandlerFunc</span><span class="p">(</span><span class="k">func</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">token</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">BasicAuth</span><span class="p">()</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">ok</span> <span class="p">{</span>
      <span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="err">â€œ</span><span class="n">Unauthorized</span><span class="err">â€</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusUnauthorized</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="n">user</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">us</span><span class="o">.</span><span class="n">User</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="err">â€œ</span><span class="n">Unauthorized</span><span class="err">â€</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusUnauthorized</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="n">permit</span> <span class="o">:=</span> <span class="no">false</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">orgID</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">user</span><span class="o">.</span><span class="n">OrgIDs</span> <span class="p">{</span>
      <span class="k">if</span> <span class="n">orgId</span> <span class="o">==</span> <span class="n">reqOrgID</span> <span class="p">{</span>
        <span class="n">permit</span> <span class="o">=</span> <span class="no">true</span>
        <span class="k">break</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">permit</span> <span class="p">{</span>
      <span class="n">http</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="err">â€œ</span><span class="n">Unauthorized</span><span class="err">â€</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusUnauthorized</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="c">// user is authenticated, let them in</span>
    <span class="n">next</span><span class="o">.</span><span class="n">ServeHTTP</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre> 
<p>ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿç”¨æˆ·æœåŠ¡æµ‹è¯•æ­¤ä»£ç ã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">mock</span>

<span class="k">type</span> <span class="n">UserService</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">UserFn</span> <span class="k">func</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">github</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">us</span> <span class="o">*</span><span class="n">UserService</span><span class="p">)</span> <span class="n">Authenticate</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">github</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">us</span><span class="o">.</span><span class="n">UserFn</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="p">}</span>
</code></pre> 
<p>åˆ›å»ºæ¨¡æ‹Ÿç”¨æˆ·æœåŠ¡æœ‰å¾ˆå¤šæ–¹å¼ï¼Œä½†æ˜¯è¿™ä¸ªé€šå¸¸éœ€è¦æµ‹è¯•è®¤è¯æ­£å¸¸é€šè¿‡æ—¶å’Œè®¤è¯å‡ºç°é—®é¢˜æ—¶çš„ä¸åŒæƒ…å†µã€‚</p>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯¹è®¤è¯ä¸­é—´ä»¶å®Œæˆæµ‹è¯•ã€å‘å¸ƒï¼Œç”Ÿæ´»ä¼¼ä¹å¾ˆæ„‰å¿«ã€‚</p>

<p>ç„¶åï¼Œæ‚²å‰§å‘ç”Ÿäº†ã€‚ä½ çš„ CEO å¬è¯´å“¥æ–¯æ‹‰ï¼ˆè¯‘è€…æ³¨ï¼šå“¥æ–¯æ‹‰æ¯ç­ä¸–ç•Œï¼Ÿï¼‰æ­£åœ¨å‰å¾€æ—§é‡‘å±±ï¼Œä½ çš„å…¬å¸æ— æ³•åœ¨æœªæ¥ä¸ç¡®å®šçš„æƒ…å†µä¸‹ç»§ç»­ä¾èµ– Githubã€‚å¦‚æœ Github æ•´ä¸ªåŠå…¬å®¤è¢«æ‘§æ¯äº†ï¼Œæ²¡æœ‰å·¥ç¨‹å¸ˆç»§ç»­ç»´æŠ¤è¯¥äº§å“æ€ä¹ˆåŠï¼Ÿä¸ï¼Œå®Œå…¨ä¸èƒ½æ¥å—ï¼</p>

<p>å¹¸è¿çš„æ˜¯ï¼Œè¿˜æœ‰ä¸€å®¶åä¸º GitLab çš„æ›¿ä»£å…¬å¸ï¼Œä¼¼ä¹åšäº†å¾ˆå¤šç±»ä¼¼ GitHub çš„åŠŸèƒ½ï¼Œä¸åŒçš„æ˜¯ä»–ä»¬æ˜¯ä¸€ä¸ªè¿œç¨‹å·¥ä½œå›¢é˜Ÿã€‚è¿™æ„å‘³ç€å“¥æ–¯æ‹‰æ°¸è¿œæ— æ³•åŒæ—¶æ¶ˆç­æ‰€æœ‰å·¥ç¨‹å¸ˆï¼Œå¯¹å—ï¼Ÿ ğŸ‰</p>

<p>é«˜å±‚ä¼¼ä¹è®¤åŒè¿™ä¸ªé€»è¾‘ï¼Œä»–ä»¬å¼€å§‹è¿›è¡Œè¿ç§»ã€‚ä½ çš„å·¥ä½œï¼Ÿä½ çš„ä»»åŠ¡æ˜¯ä¿è¯æ‰€æœ‰è®¤è¯ä»£ç èƒ½å¤Ÿåœ¨æ–°ç³»ç»Ÿä¸Šæ­£å¸¸è¿è¡Œï¼</p>

<p>ä½ èŠ±äº†ä¸€äº›æ—¶é—´æŸ¥çœ‹ GitLab API æ–‡æ¡£ï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼Œçœ‹èµ·æ¥ä»–ä»¬é‡‡ç”¨äº†å’Œ Github ç±»ä¼¼çš„ç­–ç•¥ã€‚GitLab åŒæ ·ä¹Ÿæœ‰ä¸ªäººè®¿é—®ä»¤ç‰Œï¼Œç»„ç»‡ï¼Œä½ åªéœ€è¦é‡æ–°å®ç°å®¢æˆ·ç«¯å³å¯ã€‚ä¸­é—´ä»¶ä¸­çš„ä»£ç å®Œå…¨ä¸éœ€è¦æ›´æ”¹ï¼Œå› ä¸ºä½ æ˜¯ä¸€ä¸ªèªæ˜äººï¼Œä½ ä½¿ç”¨äº†æ¥å£ï¼ ğŸ˜ ç°åœ¨ä½ åªéœ€è¦åˆ›å»ºä¸€ä¸ª Github å®¢æˆ·ç«¯â€¦</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">gitlab</span>

<span class="k">type</span> <span class="n">User</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">ID</span>    <span class="kt">string</span>
  <span class="n">Email</span> <span class="kt">string</span>
  <span class="n">OrgIDs</span> <span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">Client</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Key</span>   <span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">Client</span><span class="p">)</span> <span class="n">User</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// ä¸Gitlab APIäº¤äº’ï¼Œè¿”å›ç”¨æˆ·å’Œå¯¹åº”çš„ç»„ç»‡c.OrgID</span>
<span class="p">}</span>
</code></pre> 
<p>ç°åœ¨ï¼ŒæŠŠè¿™ä¸ªåŠŸèƒ½æ”¾å…¥<code>AuthMiddleware</code>ä¸­ï¼Œä½†æ˜¯ï¼Œå®ƒå´ä¸èƒ½æ­£å¸¸å·¥ä½œäº†ï¼</p>

<p>äº‹å®è¯æ˜ï¼Œå³ä½¿æ¥å£ä¹Ÿå¯èƒ½æˆä¸ºè€¦åˆçš„å—å®³è€…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å› ä¸ºä½ çš„æ¥å£æœŸæœ›é€šè¿‡<code>User</code>æ–¹æ³•è¿”å›<code>github.User</code> ã€‚ </p>
 <pre class="highlight go"><code><span class="k">type</span> <span class="n">UserService</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">User</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">github</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
                      <span class="o">^^^^^^^^^^^</span>
<span class="p">}</span>
</code></pre> 
<p>æ€ä¹ˆåŠï¼Ÿè€æ¿å¸Œæœ›æ˜å¤©å°±è¦å‘å¸ƒäº†ï¼</p>

<p>ç°åœ¨ï¼Œä½ æœ‰å‡ ç§é€‰æ‹©ï¼š</p>

<ol>
<li>ä¿®æ”¹ä¸­é—´ä»¶ï¼Œä»¥ä¾¿<code>UserService</code>æ¥å£è¿”å›<code>gitlab.User</code>è€Œä¸æ˜¯<code>github.User</code>ï¼›</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸“é—¨ç”¨äº GitLab çš„èº«ä»½éªŒè¯ä¸­é—´ä»¶ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªé€šç”¨çš„ç”¨æˆ·ç±»å‹ï¼Œèƒ½å¤Ÿåœ¨<code>AuthMiddleware</code>ä¸­å¯ä»¥è‡ªç”±åˆ‡æ¢ä½ çš„ github å’Œ gitlab å®ç°ã€‚</li>
</ol>

<p>å¦‚æœä½ ç¡®ä¿¡è‡ªå·±çš„å…¬å¸ä»¥åç»§ç»­ä½¿ç”¨ GitLabï¼Œåˆ™æ–¹æ¡ˆ 1 å°±æœ‰æ„ä¹‰ã€‚å½“ç„¶ï¼Œä½ éœ€è¦åŒæ—¶æ›´æ”¹ç”¨æˆ·æœåŠ¡æ¥å£å’Œ mockï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸€æ¬¡æ€§çš„ä¿®æ”¹ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ¡ˆå¹¶ä¸åã€‚</p>

<p>å½“ç„¶ï¼Œä½ å¹¶ä¸çœŸæ­£çŸ¥é“ä½ ä»¬æ˜¯å¦ä¼šåšæŒä½¿ç”¨ GitLabã€‚ä¹Ÿè®¸å“¥æ–¯æ‹‰ä¼šæ”¹å˜å®ƒçš„æ”»å‡»è®¡åˆ’ï¼Ÿ</p>

<p>å¦‚æœç¨‹åºä¸­å¾ˆå¤šä»£ç éƒ½ä¾èµ–æ­¤ç¨‹åºåŒ…è¿”å›çš„<code>github.User</code>ç±»å‹ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¹Ÿä¼šå¸¦æ¥å¾ˆå¤šéº»çƒ¦ã€‚</p>

<p>æ–¹æ¡ˆ 2 ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å®ƒçœ‹èµ·æ¥æœ‰ç‚¹å‚»å‚»çš„ã€‚å½“é€»è¾‘ä¸å˜æ—¶ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é‡å†™ä¸€éæ‰€æœ‰çš„ä»£ç å’Œæµ‹è¯•ï¼Ÿå½“ç„¶ï¼Œä¸€å®šæœ‰ä¸€ç§æ¥å£å¯ä»¥æŒ‰ç…§ä½ æœ€åˆçš„æ„å›¾å®ç°åŠŸèƒ½ã€‚æ¯•ç«Ÿï¼Œä¸­é—´ä»¶ä¸å…³å¿ƒæŸ¥è¯¢çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬åªæ˜¯éœ€è¦å¤„ç†å…¶ä¸­ä¸€äº›é‡è¦ä¿¡æ¯ã€‚</p>

<p>ç°åœ¨ï¼Œä½ å†³å®šå°è¯•ä¸€ä¸‹æ–¹æ¡ˆ 3ã€‚ä½ åˆ›å»ºäº†ä¸€ä¸ª<code>mw</code>åŒ…ï¼Œå®šä¹‰äº†ä¸€ä¸ª<code>User</code>ç±»å‹ï¼Œç„¶åå‡†å¤‡ç¼–å†™ä¸€ä¸ªé€‚é…å™¨å°†å…¶ä¸ Github å’Œ Gitlab å®¢æˆ·ç«¯è¿æ¥ã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">mw</span>

<span class="k">type</span> <span class="n">User</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">OrgIDs</span> <span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">UserService</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">User</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre> 
<p>å½“ä½ ç¼–å†™ä»£ç æ—¶ï¼Œä½ æ„è¯†åˆ°ï¼Œä½ å®é™…ä¸Šå¹¶ä¸å…³å¿ƒç”¨æˆ· ID æˆ–è€…ç”µå­é‚®ä»¶ç­‰ç­‰å…¶ä»–ä¿¡æ¯ï¼Œå› æ­¤ä½ å®Œå…¨å¯ä»¥ä»<code>mw.User</code>ä¸­åˆ é™¤è¿™äº›å­—æ®µï¼Œä½ åªéœ€è¦åˆ¶å®šä½ å…³å¿ƒçš„å­—æ®µï¼Œè¿™æ ·å°±å¯ä»¥è®©ä»£ç æ›´å®¹æ˜“ç»´æŠ¤å’Œæµ‹è¯•ã€‚æ£’æäº†ï¼</p>

<p>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ï¼Œä»¥ä¾¿ä½ å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œã€‚</p>
 <pre class="highlight go"><code><span class="c">// Package adapter probably isnâ€™t a great package name, but this is a</span>
<span class="c">// demo so deal with it.</span>
<span class="k">package</span> <span class="n">adapter</span>

<span class="k">type</span> <span class="n">GitHubUserService</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Client</span> <span class="o">*</span><span class="n">github</span><span class="o">.</span><span class="n">Client</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">us</span> <span class="o">*</span><span class="n">GitHubUserService</span><span class="p">)</span> <span class="n">User</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">mw</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ghUser</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">us</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">User</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">mw</span><span class="o">.</span><span class="n">User</span><span class="p">{},</span> <span class="n">err</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">mw</span><span class="o">.</span><span class="n">User</span><span class="p">{</span>
    <span class="n">OrgIDs</span><span class="o">:</span> <span class="n">ghUser</span><span class="o">.</span><span class="n">OrgIDs</span><span class="p">,</span>
  <span class="p">},</span> <span class="no">nil</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">GitLabUserService</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Client</span> <span class="o">*</span><span class="n">gitlab</span><span class="o">.</span><span class="n">Client</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">us</span> <span class="o">*</span><span class="n">GitLabUserservice</span><span class="p">)</span> <span class="n">User</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">mw</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">glUser</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">us</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">User</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">mw</span><span class="o">.</span><span class="n">User</span><span class="p">{},</span> <span class="n">err</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">mw</span><span class="o">.</span><span class="n">User</span><span class="p">{</span>
    <span class="n">OrgIDs</span><span class="o">:</span> <span class="n">glUser</span><span class="o">.</span><span class="n">OrgIDs</span><span class="p">,</span>
  <span class="p">},</span> <span class="no">nil</span>
<span class="p">}</span>
</code></pre> 
<p>ä½ ä¹Ÿéœ€è¦æ›´æ–°ä½ çš„ mockï¼Œä¸è¿‡è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¿«çš„ä¿®æ”¹ã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">mock</span>

<span class="k">type</span> <span class="n">UserService</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">UserFn</span> <span class="k">func</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">mw</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">us</span> <span class="o">*</span><span class="n">UserService</span><span class="p">)</span> <span class="n">Authenticate</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">mw</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">us</span><span class="o">.</span><span class="n">UserFn</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="p">}</span>
</code></pre> 
<p>ç°åœ¨ï¼Œå¦‚æœä½ æƒ³å°†æˆ‘ä»¬çš„<code>AuthMiddleware</code>ä¸ GitHub æˆ– GitLab ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œæ“ä½œï¼š</p>
 <pre class="highlight go"><code><span class="k">var</span> <span class="n">myHandler</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span>
<span class="k">var</span> <span class="n">us</span> <span class="n">mw</span><span class="o">.</span><span class="n">UserService</span>
<span class="n">us</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">GitLabUserservice</span><span class="p">{</span>
  <span class="n">Client</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">gitlab</span><span class="o">.</span><span class="n">Client</span><span class="p">{</span>
    <span class="n">Key</span><span class="o">:</span> <span class="err">â€œ</span><span class="n">abc</span><span class="o">-</span><span class="m">123</span><span class="err">â€</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">}</span>
<span class="c">// This protects your handler</span>
<span class="n">myHandler</span> <span class="o">=</span> <span class="n">mw</span><span class="o">.</span><span class="n">AuthMiddleware</span><span class="p">(</span><span class="n">us</span><span class="p">,</span> <span class="err">â€œ</span><span class="n">my</span><span class="o">-</span><span class="n">org</span><span class="o">-</span><span class="n">id</span><span class="err">â€</span><span class="p">,</span> <span class="n">myHandler</span><span class="p">)</span>
</code></pre> 
<p>æˆ‘ä»¬ç»ˆäºæœ‰äº†ä¸€ä¸ªå®Œå…¨è§£è€¦çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨ GitHub å’Œ GitLab ä¹‹é—´åˆ‡æ¢ï¼Œå¹¶ä¸”å½“æ–°çš„æºç ç®¡ç†å…¬å¸å‡ºç°æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå¿«è·Ÿä¸Šæ½®æµã€‚</p>
<h2 id="å¯»æ‰¾ä¸­é—´æ–¹æ¡ˆ">å¯»æ‰¾ä¸­é—´æ–¹æ¡ˆ</h2>
<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥çœ‹åˆ°äº†ä»£ç ä»ç´§å¯†è€¦åˆåˆ°å®Œå…¨è§£è€¦çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬ä½¿ç”¨<code>adapter</code>åŒ…æ¥å®Œæˆå¤„ç†è¿™äº›è§£è€¦åçš„<code>mw</code>å’Œ<code>github/gitlab</code>åŒ…ä¹‹é—´çš„è½¬æ¢ã€‚</p>

<p>è¿™æ ·åšçš„ä¸»è¦å¥½å¤„æ˜¯æˆ‘ä»¬åœ¨æœ€åçš„æ—¶å€™çœ‹åˆ°çš„ï¼šæˆ‘ä»¬å¯ä»¥åœ¨è‡ªç”±é€‰æ‹©ä½¿ç”¨ GitHub æˆ– GitLab è®¤è¯ç­–ç•¥ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ handlers å’Œè®¤è¯ä¸­é—´ä»¶ã€‚</p>

<p>å°½ç®¡è¿™äº›å¥½å¤„éå¸¸æ£’ï¼Œä½†åœ¨ä¸è€ƒè™‘æˆæœ¬çš„æƒ…å†µä¸‹æ¢ç´¢è¿™äº›å¥½å¤„æ˜¯ä¸å…¬å¹³çš„ã€‚ æ‰€æœ‰è¿™äº›æ›´æ”¹æä¾›äº†è¶Šæ¥è¶Šå¤šçš„ä»£ç ï¼Œå¦‚æœä½ å›è¿‡å¤´å»æŸ¥çœ‹<code>gitlab</code>å’Œ<code>mw</code>è½¯ä»¶åŒ…çš„åŸå§‹ç‰ˆæœ¬ï¼Œä½ ä¼šå‘ç°å®ƒä»¬æ¯”éœ€è¦ä½¿ç”¨ adapter è½¯ä»¶åŒ…çš„æœ€ç»ˆç‰ˆæœ¬è¦ç®€å•å¾—å¤šã€‚è¿™æ ·ä¹Ÿä¼šä¹Ÿå¯èƒ½å¯¼è‡´æ›´å¤šçš„è®¾ç½®é¡¹ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬ä»£ç çš„æŸä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–æ‰€æœ‰è¿™äº›é€‚é…å™¨å¹¶å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ã€‚</p>

<p>å¦‚æœæ²¿è¿™æ¡è·¯çº¿ç»§ç»­æ¼”è¿›ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¾ˆå¿«å‘ç°æˆ‘ä»¬ä¹Ÿéœ€è¦è®¸å¤šä¸åŒçš„ User ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ GitHubï¼ˆæˆ– GitLabï¼‰ç­‰æœåŠ¡ä¸­å°†å†…éƒ¨ç”¨æˆ·ç±»å‹ä¸å¤–éƒ¨ç”¨æˆ· ID å…³è”ã€‚ è¿™å¯èƒ½å¯¼è‡´åœ¨æˆ‘ä»¬çš„æ•°æ®åº“åŒ…ä¸­å®šä¹‰ä¸€ä¸ª<code>ExternalUser</code> ï¼Œç„¶åç¼–å†™ä¸€ä¸ªé€‚é…å™¨å°†<code>github.User</code>è½¬æ¢ä¸ºè¿™ç§ç±»å‹ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æ•°æ®åº“ä»£ç ä¸æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„æœåŠ¡è§£è€¦ã€‚</p>

<p>I actually tried doing this on one project with my HTTP handlers just to see how it turned out. Specifically, I isolated every endpoint in my web application to its own package with no external dependencies specific to my web application and ended up with packages like this:
å®é™…ä¸Šï¼Œä¸ºäº†è¯æ˜è¿™ä¸ªç»“æœï¼Œæˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸Šçš„ HTTP å¤„ç†ç¨‹åºä¸Šè¿›è¡Œè¿‡å°è¯•ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘å°† Web åº”ç”¨ç¨‹åºä¸­çš„æ¯ä¸ªç«¯ç‚¹éš”ç¦»åˆ°å…¶è‡ªå·±çš„ç¨‹åºåŒ…ä¸­ï¼Œè€Œæ²¡æœ‰ç‰¹å®šäº Web åº”ç”¨ç¨‹åºçš„å¤–éƒ¨ä¾èµ–å…³ç³»ï¼Œæœ€ç»ˆå¾—åˆ°äº†åƒè¿™æ ·çš„ç¨‹åºåŒ…ï¼š</p>
 <pre class="highlight go"><code><span class="c">// Package enroll provides HTTP handlers for enrolling a user into a new</span>
<span class="c">// course.</span>
<span class="c">// This package is entirely for demonstrative purposes and hasnâ€™t been tested,</span>
<span class="c">// but if you do see obvious bugs feel free to let me know and Iâ€™ll address</span>
<span class="c">// them.</span>
<span class="k">package</span> <span class="n">enroll</span>

<span class="k">import</span> <span class="p">(</span>
  <span class="err">â€œ</span><span class="n">io</span><span class="err">â€</span>
    <span class="err">â€œ</span><span class="n">net</span><span class="o">/</span><span class="n">http</span><span class="err">â€</span>

    <span class="err">â€œ</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">gorilla</span><span class="o">/</span><span class="n">schema</span><span class="err">â€</span>
<span class="p">)</span>

<span class="c">// Data defines the data that will be provided to the HTML template when it is</span>
<span class="c">// rendered.</span>
<span class="k">type</span> <span class="n">Data</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Form</span>    <span class="n">Form</span>
  <span class="c">// Map of form fields with errors and their error message</span>
  <span class="n">Errors</span>  <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>

  <span class="n">User</span>    <span class="n">User</span>
    <span class="n">License</span> <span class="n">License</span>
<span class="p">}</span>

<span class="c">// License is used to show the user more info about what they are enrolling in.</span>
<span class="c">// Eg if they URL query params have a valid key, we might show them:</span>
<span class="c">//</span>
<span class="c">//   â€œYou are about to enroll in Gophercises - FREE using the key `abc-123`â€</span>
<span class="c">//                               ^             ^                   ^</span>
<span class="c">//                             Course       Package               Key</span>
<span class="c">//</span>
<span class="k">type</span> <span class="n">License</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Key</span>     <span class="kt">string</span>
  <span class="n">Course</span>  <span class="kt">string</span>
  <span class="n">Package</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="c">// User defines a user that can be enrolled in courses.</span>
<span class="k">type</span> <span class="n">User</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">ID</span> <span class="kt">string</span>
  <span class="c">// Email is used when rendering a navbar with the userâ€™s email address, among</span>
  <span class="c">// other areas of an HTML page.</span>
  <span class="n">Email</span> <span class="kt">string</span>
  <span class="n">Avatar</span> <span class="kt">string</span>
  <span class="c">// â€¦</span>
<span class="p">}</span>

<span class="c">// Form defines all of the HTML form fields. It assumes the Form will be</span>
<span class="c">// rendered using struct tags and a form package I created</span>
<span class="c">// (https://github.com/joncalhoun/form), but it isnâ€™t really mandatory as</span>
<span class="c">// long as the form field names match the `schema` part here.</span>
<span class="k">type</span> <span class="n">Form</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">License</span>  <span class="kt">string</span> <span class="s">`form:"name=license;label=License key;footer=You can find this in an email sent over by Gumroad after purchasing a course. Or in the case of Gophercises it will be in an email from me (jon@calhoun.io)." schema:"license"`</span>
<span class="p">}</span>

<span class="c">// Handler provides GET and POST http.Handlers</span>
<span class="k">type</span> <span class="n">Handler</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="c">// Interfaces and function types here serve roughly the same purpose. funcs</span>
  <span class="c">// just tend to be easier to write adapters for since you donâ€™t need a</span>
  <span class="c">// struct type with a method.</span>
  <span class="n">UserFn</span>    <span class="k">func</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
  <span class="n">LicenseFn</span> <span class="k">func</span><span class="p">(</span><span class="n">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">License</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>

  <span class="c">// Interface because this one is the least likely to need an adapter</span>
  <span class="n">Enroller</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Enroll</span><span class="p">(</span><span class="n">userID</span><span class="p">,</span> <span class="n">licenseKey</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>
  <span class="p">}</span>

  <span class="c">// Typically satisfied with an HTML template</span>
  <span class="n">Executor</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Execute</span><span class="p">(</span><span class="n">wr</span> <span class="n">io</span><span class="o">.</span><span class="n">Writer</span><span class="p">,</span> <span class="n">data</span> <span class="k">interface</span><span class="p">{})</span> <span class="kt">error</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c">// Get handles rendering the Form for a user to enroll in a new course.</span>
<span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span><span class="n">Handler</span><span class="p">)</span> <span class="n">Get</span><span class="p">()</span> <span class="n">http</span><span class="o">.</span><span class="n">HandlerFunc</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">func</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">user</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">h</span><span class="o">.</span><span class="n">UserFn</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="c">// redirect or render an error</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="n">data</span> <span class="n">Data</span>
    <span class="n">data</span><span class="o">.</span><span class="n">User</span> <span class="o">=</span> <span class="n">user</span>

    <span class="k">var</span> <span class="n">form</span> <span class="n">Form</span>
    <span class="n">err</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">ParseForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="c">// maybe log this? We can still render</span>
    <span class="p">}</span>
    <span class="n">dec</span> <span class="o">:=</span> <span class="n">schema</span><span class="o">.</span><span class="n">NewDecoder</span><span class="p">()</span>
    <span class="n">dec</span><span class="o">.</span><span class="n">IgnoreUnknownKeys</span><span class="p">(</span><span class="no">true</span><span class="p">)</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">dec</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">form</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">Form</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="c">// maybe log this? We can still render</span>
    <span class="p">}</span>
    <span class="n">data</span><span class="o">.</span><span class="n">Form</span> <span class="o">=</span> <span class="n">form</span>

    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">License</span> <span class="o">!=</span> <span class="err">â€œâ€</span> <span class="p">{</span>
      <span class="n">lic</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">h</span><span class="o">.</span><span class="n">LicenseFn</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">License</span><span class="p">)</span>
      <span class="n">data</span><span class="o">.</span><span class="n">License</span> <span class="o">=</span> <span class="n">lic</span>
      <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Errors</span> <span class="o">=</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
          <span class="err">â€œ</span><span class="n">license</span><span class="err">â€</span><span class="o">:</span> <span class="err">â€œ</span><span class="n">is</span> <span class="n">not</span> <span class="n">valid</span><span class="err">â€</span><span class="p">,</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">h</span><span class="o">.</span><span class="n">Executor</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">// Post handles processing the form and enrolling a user.</span>
<span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span><span class="n">Handler</span><span class="p">)</span> <span class="n">Post</span><span class="p">()</span> <span class="n">http</span><span class="o">.</span><span class="n">HandlerFunc</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">func</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">user</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">h</span><span class="o">.</span><span class="n">UserFn</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="c">// redirect or render an error</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="n">data</span> <span class="n">Data</span>
    <span class="n">data</span><span class="o">.</span><span class="n">User</span> <span class="o">=</span> <span class="n">user</span>

    <span class="k">var</span> <span class="n">form</span> <span class="n">Form</span>
    <span class="n">err</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">ParseForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="c">// maybe log this? We can still render</span>
    <span class="p">}</span>
    <span class="n">dec</span> <span class="o">:=</span> <span class="n">schema</span><span class="o">.</span><span class="n">NewDecoder</span><span class="p">()</span>
    <span class="n">dec</span><span class="o">.</span><span class="n">IgnoreUnknownKeys</span><span class="p">(</span><span class="no">true</span><span class="p">)</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">dec</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">form</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">Form</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="c">// maybe log this? We can still render</span>
    <span class="p">}</span>
    <span class="n">data</span><span class="o">.</span><span class="n">Form</span> <span class="o">=</span> <span class="n">form</span>

    <span class="n">err</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">Enroller</span><span class="o">.</span><span class="n">Enroll</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">License</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="n">data</span><span class="o">.</span><span class="n">Errors</span> <span class="o">=</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
        <span class="err">â€œ</span><span class="n">license</span><span class="err">â€</span><span class="o">:</span> <span class="err">â€œ</span><span class="n">is</span> <span class="n">not</span> <span class="n">valid</span><span class="err">â€</span><span class="p">,</span>
      <span class="p">}</span>
      <span class="c">// Re-render the form</span>
      <span class="n">h</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="p">}</span>
    <span class="n">http</span><span class="o">.</span><span class="n">Redirect</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="err">â€œ</span><span class="o">/</span><span class="n">courses</span><span class="err">â€</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusFound</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre> 
<p>ä»ç†è®ºä¸Šè®²ï¼Œè¿™ä¸ªæƒ³æ³•å¬èµ·æ¥å¾ˆé…·ã€‚ ç°åœ¨ï¼Œæˆ‘å¯ä»¥å•ç‹¬å®šä¹‰æ‰€æœ‰ HTTP å¤„ç†ç¨‹åºï¼Œä¸å¿…æ‹…å¿ƒåº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†çš„å½±å“ã€‚ æ¯ä¸ªåŒ…éƒ½å¯ä»¥è½»æ¾æµ‹è¯•ï¼Œå½“æˆ‘ç¼–å†™è¿™äº›ç‹¬ç«‹çš„ä½œå“æ—¶ï¼Œæˆ‘å‘ç°è‡ªå·±çš„å·¥ä½œæ•ˆç‡éå¸¸é«˜ã€‚ æˆ‘ç”šè‡³æœ‰ä¸€ä¸ªåä¸º<code>Executor</code>çš„æ¥å£ï¼Œè°ä¸æƒ³åœ¨ä»–ä»¬çš„ä»£ç ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„æ‰§è¡Œå™¨ï¼Ÿï¼</p>

<p>åœ¨å®è·µä¸­ï¼Œè¿™ä¸ªæƒ³æ³•å¯¹æˆ‘çš„ç‰¹å®šç”¨ä¾‹è€Œè¨€å¤ªç³Ÿç³•äº†ã€‚æ˜¯çš„ï¼Œè¿™ç§æ–¹æ³•ç¡®å®æœ‰å¥½å¤„ï¼Œä½†æ˜¯å®ƒä»¬å¹¶æ²¡æœ‰è¶…è¿‡ç¼–å†™æ‰€æœ‰è¿™äº›ä»£ç çš„æˆæœ¬ã€‚ åœ¨åˆ›å»º<code>enroll</code>å’Œç±»ä¼¼è½¯ä»¶åŒ…çš„å†…éƒ¨ç»„ä»¶æ—¶ï¼Œæˆ‘çš„å·¥ä½œæ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯æˆ‘èŠ±äº†å¾ˆå¤šæ—¶é—´ç¼–å†™é€‚é…å™¨å¹¶å°†å„ä¸ªéƒ¨åˆ†è¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™ä½¿æˆ‘çš„æ•´ä½“ç”Ÿäº§ç‡ä¸‹é™äº†ã€‚ æˆ‘æ‰¾ä¸åˆ°ä¸€ç§æ— éœ€ç¼–å†™è‡ªå®šä¹‰<code>UserFn</code> ï¼Œ <code>LicenseFn</code>çš„å¿«é€Ÿæ–¹æ³•å°±å¯ä»¥å°†å…¶å¼•å…¥åˆ°ä»£ç ä¸­çš„æ–¹æ¡ˆï¼Œè€Œä¸”æˆ‘å‘ç°è‡ªå·±ä¸ºå¸¦æœ‰ HTTP å¤„ç†ç¨‹åºçš„æ¯ä¸ªç¨‹åºåŒ…ç¼–å†™äº†ä¸€å †å‡ ä¹ç›¸åŒçš„<code>UserFn</code>å˜ç§ã€‚</p>

<p>è¿™å¼•å‡ºäº†æœ¬èŠ‚çš„ä¸»é¢˜- <strong>æ˜¯å¦æœ‰åŠæ³•å®ç°å¯æ¥å—çš„ä¸­é—´æ–¹æ¡ˆï¼Ÿ</strong></p>

<p>æˆ‘å–œæ¬¢å°†æˆ‘çš„ä»£ç ä¸ç¬¬ä¸‰æ–¹ä¾èµ–é¡¹è§£è€¦ã€‚æˆ‘ä¹Ÿå–œæ¬¢ç¼–å†™å¯æµ‹è¯•çš„ä»£ç ã€‚ä½†æ˜¯æˆ‘ä¸å–œæ¬¢é€šè¿‡åŠ å€çš„ç¼–ç å·¥ä½œæ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚å½“ç„¶ï¼Œè¿™é‡Œå¿…ç„¶æœ‰ä¸€ä¸ªä¸­é—´æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨æ²¡æœ‰æ‰€æœ‰é¢å¤–ä»£ç çš„æƒ…å†µä¸‹ä¸ºæˆ‘ä»¬æä¾›å¤§å¤šæ•°å¥½å¤„ï¼Œå¯¹å—ï¼Ÿ</p>

<p><strong>æ˜¯çš„ï¼Œæ˜¯æœ‰ä¸­é—´æ–¹æ¡ˆçš„</strong>ï¼Œæ‰¾åˆ°å®ƒçš„å…³é”®ä¸æ˜¯æ¶ˆé™¤æ‰€æœ‰è€¦åˆï¼Œè€Œæ˜¯æœ‰æ„åœ°é€‰æ‹©ä»£ç æ‰€è€¦åˆçš„å†…å®¹ã€‚</p>

<p>è®©æˆ‘ä»¬å›åˆ°<code>github</code>å’Œ<code>gitlab</code>åŒ…çš„åŸå§‹ç¤ºä¾‹ã€‚åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼ˆç´§å¯†è€¦åˆç‰ˆæœ¬ï¼‰ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª<code>mw</code>åŒ…æ‰€ä¾èµ–çš„<code>github.User</code>ç±»å‹ã€‚ å®ƒæ»¡è¶³ä½¿ç”¨ï¼Œå¹¶ä¸”æˆ‘ä»¬ç”šè‡³å¯ä»¥å›´ç»•å®ƒæ„å»ºæ¥å£ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶ä¸<code>github</code>åŒ…ç´§å¯†è€¦åˆã€‚</p>

<p>åœ¨ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼ˆè§£è€¦ç‰ˆæœ¬ï¼‰ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª<code>github.User</code> ï¼Œ<code>gitlab.User</code>å’Œ<code>mw.User</code>ã€‚ è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè§£è€¦æ‰€æœ‰å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»åˆ›å»ºå°†è¿™äº›è§£è€¦çš„ä»£ç è¿æ¥åœ¨ä¸€èµ·çš„é€‚é…å™¨ã€‚</p>

<p>The middle ground, and the third version we will explore, is to intentionally define a User type that every package is allowed to be tightly coupled to. By doing this, we are intentionally choosing where that coupling happens and can make that decision in a way that still makes it easy to test, swap implementations, and do everything else we desire from decoupled code.
æˆ‘ä»¬å³å°†æ¢ç´¢çš„ç¬¬ä¸‰ç§ä¸­é—´æ–¹æ¡ˆï¼Œæ˜¯æœ‰æ„å…è®¸å®šä¹‰æ¯ä¸ªåŒ…ç´§å¯†è€¦åˆçš„<code>User</code>ç±»å‹ã€‚é€šè¿‡è¿™ç§æ“ä½œï¼Œæˆ‘ä»¬åˆ»æ„é€‰æ‹©å‘ç”Ÿè€¦åˆçš„ä½ç½®ï¼Œå¹¶ä¸”ä¿è¯æ˜“äºæµ‹è¯•ã€æ–¹ä¾¿å®ç°äº¤æ¢å’Œæ˜“äºå…¶ä»–ä¸ºè§£è€¦ä»£ç å®ç°çš„ä¸€åˆ‡æ–¹å¼ã€‚</p>

<p>é¦–å…ˆæ˜¯æˆ‘ä»¬çš„<code>User</code>ç±»å‹ã€‚ è¿™å°†åœ¨<code>domain</code>åŒ…ä¸­åˆ›å»ºï¼Œæˆ‘ä»¬åº”ç”¨ä¸­çš„ä»»ä½•å…¶ä»–åŒ…éƒ½å¯ä»¥å¯¼å…¥ã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">domain</span>

<span class="k">type</span> <span class="n">User</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">ID</span>    <span class="kt">string</span>
  <span class="n">Email</span> <span class="kt">string</span>
  <span class="n">OrgIDs</span> <span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>
</code></pre> 
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é‡å†™<code>github</code>å’Œ<code>gitlab</code>è½¯ä»¶åŒ…ä»¥åˆ©ç”¨æ­¤<code>domain.User</code>ç±»å‹ã€‚ è¿™äº›åŸºæœ¬ç›¸åŒï¼Œå› ä¸ºæˆ‘å»é™¤äº†æ‰€æœ‰çš„çœŸå®é€»è¾‘ï¼Œåªå±•ç¤ºå…¶ä¸­ä¸€ä¸ªã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">gitlab</span> <span class="c">// github is the same basically</span>

<span class="k">type</span> <span class="n">Client</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Key</span>   <span class="kt">string</span>
<span class="p">}</span>

<span class="c">// Note the return type is domain.User here - this code is now coupled to our</span>
<span class="c">// domain.</span>
<span class="k">func</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">Client</span><span class="p">)</span> <span class="n">User</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// â€¦ interact with the gitlab API, and return a user if they are in an org with the c.OrgID</span>
<span class="p">}</span>
</code></pre> 
<p>æœ€åï¼Œæˆ‘ä»¬æœ‰äº†<code>mw</code>è½¯ä»¶åŒ…ã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">mw</span>

<span class="k">type</span> <span class="n">UserService</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">User</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">AuthMiddleware</span><span class="p">(</span><span class="n">us</span> <span class="n">UserService</span><span class="p">,</span> <span class="n">reqOrgID</span> <span class="kt">string</span><span class="p">,</span> <span class="n">next</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span><span class="p">)</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span> <span class="p">{</span>
  <span class="c">// unchanged</span>
<span class="p">}</span>
</code></pre> 
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨æ­¤ç¼–å†™ä¸€ä¸ªæ¨¡æ‹ŸåŒ…ã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">mock</span>

<span class="k">type</span> <span class="n">UserService</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">UserFn</span> <span class="k">func</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">us</span> <span class="o">*</span><span class="n">UserService</span><span class="p">)</span> <span class="n">Authenticate</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">us</span><span class="o">.</span><span class="n">UserFn</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="p">}</span>
</code></pre> <h2 id="é¢†åŸŸé©±åŠ¨è®¾è®¡">é¢†åŸŸé©±åŠ¨è®¾è®¡</h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä¸€ç›´åŠªåŠ›é¿å…ä½¿ç”¨ä»»ä½•ä»¤äººå›°æƒ‘çš„æœ¯è¯­ï¼Œå› ä¸ºæˆ‘å‘ç°å®ƒä»¬é€šå¸¸ä¼šä½¿é—®é¢˜å˜å¾—å¤æ‚è€Œä¸æ˜¯ç®€åŒ–å®ƒä»¬ã€‚å¦‚æœä½ ä¸ç›¸ä¿¡æˆ‘ï¼Œè¯·å°è¯•é˜…è¯»æœ‰å…³åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„ä»»ä½•æ–‡ç« ï¼Œä¹¦ç±æˆ–å…¶ä»–èµ„æºã€‚ä»–ä»¬å‡ ä¹æ€»æ˜¯ä½¿ä½ åœ¨ä»£ç ä¸­å®é™…å®ç°æƒ³æ³•å¸¦æ¥æ›´å¤šçš„ç–‘é—®å’Œæ›´å°‘çš„æ˜ç¡®ç­”æ¡ˆã€‚</p>

<p>æˆ‘ä¸æ˜¯åœ¨è¯´æ˜ DDD æ²¡æœ‰ç”¨ï¼Œä¹Ÿä¸æ˜¯åœ¨å»ºè®®ä½ ä¸è¦è¯»é‚£äº›ä¹¦ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œæˆ‘çš„å¾ˆå¤šï¼ˆå¤§å¤šæ•°ï¼‰è¯»è€…åœ¨è¿™é‡Œæ˜¯ä¸ºäº†å¯»æ±‚æœ‰å…³å¦‚ä½•æ”¹è¿›å…¶ä»£ç çš„æ›´å®ç”¨å»ºè®®ï¼Œè€Œä¸æ˜¯è®¨è®ºè½¯ä»¶å¼€å‘ç†è®ºã€‚</p>

<p>ä»å®é™…çš„æ‰§è¡Œè§’åº¦æ¥çœ‹ï¼Œé¢†åŸŸé©±åŠ¨è®¾è®¡çš„ä¸»è¦å¥½å¤„æ˜¯ç¼–å†™å¯ä»¥éšæ—¶é—´å˜åŒ–è€Œå˜åŒ–çš„è½¯ä»¶ã€‚æˆ‘å‘ç°åœ¨ Go ä¸­å®ç°æ­¤ç›®æ ‡çš„æœ€ä½³æ–¹æ³•æ˜¯æ¸…æ¥šåœ°å®šä¹‰ä½ çš„é¢†åŸŸç±»å‹ï¼Œç„¶åç¼–å†™ä¾èµ–äºè¿™äº›ç±»å‹çš„å®ç°ã€‚è¿™ä»ç„¶ä¼šå¯¼è‡´ä»£ç è€¦åˆï¼Œä½†æ˜¯ç”±äºä½ çš„é¢†åŸŸä¸é—®é¢˜ç´§å¯†ç›¸å…³ï¼Œå› æ­¤ä½ è§£å†³è¿™ç§è€¦åˆå¹¶ä¸å›°éš¾ã€‚å®é™…ä¸Šï¼Œæˆ‘ç»å¸¸å‘ç°ï¼Œéœ€è¦å¯¹é¢†åŸŸæ¨¡å‹è¿›è¡Œæ¸…æ™°çš„å®šä¹‰æ˜¯æœ‰å¯å‘æ€§çš„ï¼Œè€Œä¸æ˜¯éº»çƒ¦çš„ã€‚</p>

<p><em>æ³¨æ„ï¼šå®šä¹‰å…·ä½“é¢†åŸŸç±»å‹å¹¶å°†ä»£ç è€¦åˆåˆ°å®ƒä»¬çš„æƒ³æ³•å¹¶ä¸æ˜¯ç‹¬åˆ›çš„æˆ–æ–°é¢–çš„ã€‚æœ¬Â·çº¦ç¿°é€Šåœ¨<a href="https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1" rel="nofollow" target="_blank" title="">2016 å¹´æ’°å†™çš„</a> è¿™ç¯‡æ–‡ç« ï¼Œå¯¹äºä»»ä½•æ–°å…¥é—¨çš„ Gopher æ¥è¯´ä»ç„¶æ˜¯éå¸¸æœ‰ä»·å€¼çš„æ–‡ç« ã€‚</em></p>

<p>å›åˆ°å‰é¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨<code>domain</code>åŒ…ä¸­å®šä¹‰äº†æˆ‘ä»¬çš„é¢†åŸŸ ï¼š</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">domain</span>

<span class="k">type</span> <span class="n">User</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">ID</span>    <span class="kt">string</span>
  <span class="n">Email</span> <span class="kt">string</span>
  <span class="n">OrgIDs</span> <span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>
</code></pre> 
<p>å†è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å¼€å§‹å®šä¹‰åŸºæœ¬çš„æ„å»ºå—ï¼Œè€Œæˆ‘ä»¬çš„å…¶ä½™åº”ç”¨å¯ä»¥å®ç°æˆ–è€…åœ¨ä¸ä¸å®ç°ç»†èŠ‚è€¦åˆçš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ ä¾‹å¦‚æˆ‘ä»¬çš„ UserService ï¼š</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">domain</span>

<span class="k">type</span> <span class="n">User</span> <span class="k">struct</span> <span class="p">{</span> <span class="err">â€¦</span> <span class="p">}</span>

<span class="k">type</span> <span class="n">UserService</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">User</span><span class="p">(</span><span class="n">token</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre> 
<p>è¿™æ˜¯ç”±<code>github</code>å’Œ<code>gitlab</code>åŒ…å®ç°çš„æ¥å£ï¼Œå¹¶åœ¨<code>mw</code>åŒ…ä¸­ä½¿ç”¨ã€‚ å®ƒä¹Ÿå¯ä»¥è¢«æˆ‘ä»¬ä»£ç ä¸­çš„å…¶ä»–è½¯ä»¶åŒ…æ‰€ä½¿ç”¨ï¼Œè€Œä¸ç”¨å…³å¿ƒå®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚è€Œä¸”ç”±äºå®ƒæ˜¯åœ¨é¢†åŸŸä¸­å®šä¹‰çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒæ¯ä¸ªå®ç°çš„è¿”å›ç±»å‹éƒ½ä¼šæœ‰æ‰€å˜åŒ–-å®ƒä»¬éƒ½åŸºäºä¸€ä¸ªé€šç”¨çš„å®šä¹‰å¯ä»¥æ„å»ºã€‚</p>

<p>éšç€åº”ç”¨ç¨‹åºçš„å‘å±•å’Œå˜åŒ–ï¼Œè¿™ç§å®šä¹‰é€šç”¨æ¥å£çš„æƒ³æ³•å˜å¾—æ›´åŠ å¼ºå¤§ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç¨å¾®å¤æ‚çš„ UserService ï¼šä¹Ÿè®¸å®ƒä¼šå¤„ç†åˆ›å»ºç”¨æˆ·ï¼ŒéªŒè¯ç”¨æˆ·ï¼Œé€šè¿‡ä»¤ç‰ŒæŸ¥æ‰¾ç”¨æˆ·ï¼Œé€šè¿‡å¯†ç é‡ç½®ä»¤ç‰Œï¼Œæ›´æ”¹å¯†ç ç­‰æ“ä½œã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">domain</span>

<span class="k">type</span> <span class="n">UserStore</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Create</span><span class="p">(</span><span class="n">NewUser</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">User</span><span class="p">,</span> <span class="n">RememberToken</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
    <span class="n">Authenticate</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">pw</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">User</span><span class="p">,</span> <span class="n">RememberToken</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
    <span class="n">ByToken</span><span class="p">(</span><span class="n">RememberToken</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">User</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
    <span class="n">ResetToken</span><span class="p">(</span><span class="n">email</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">ResetToken</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
    <span class="n">UpdatePw</span><span class="p">(</span><span class="n">pw</span> <span class="kt">string</span><span class="p">,</span> <span class="n">tok</span> <span class="n">ResetToken</span><span class="p">)</span> <span class="p">(</span><span class="n">RememberToken</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre> 
<p>æˆ‘ä»¬å¯èƒ½é¦–å…ˆä½¿ç”¨çº¯ SQL ä»£ç å’Œæœ¬åœ°æ•°æ®åº“æ¥å®ç°ï¼š</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">sql</span>

<span class="k">type</span> <span class="n">UserStore</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">DB</span> <span class="o">*</span><span class="n">sql</span><span class="o">.</span><span class="n">DB</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">us</span> <span class="o">*</span><span class="n">UserStore</span><span class="p">)</span> <span class="n">Create</span><span class="p">(</span><span class="n">newUser</span> <span class="n">domain</span><span class="o">.</span><span class="n">NewUser</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">domain</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">domain</span><span class="o">.</span><span class="n">RememberToken</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// â€¦</span>
<span class="p">}</span>

<span class="c">// â€¦ and more methods</span>
</code></pre> 
<p>å³ä¾¿å½“æˆ‘ä»¬åªæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œä½†æ˜¯ä¹Ÿè®¸æˆ‘ä»¬ä¼šæˆé•¿ä¸ºå¦ä¸€ä¸ª Googleï¼Œæˆ‘ä»¬å†³å®šä¸€ä¸ªé›†ä¸­çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œè¿™æ ·æˆ‘ä»¬æ‰€æœ‰å•ç‹¬çš„åº”ç”¨éƒ½å¯ä»¥ä½¿ç”¨è¿™å¥—ç³»ç»Ÿã€‚</p>

<p>å¦‚æœæˆ‘ä»¬å°†ä»£ç è€¦åˆåˆ° sql å®ç°ï¼Œè¿™åŸºæœ¬å¾ˆéš¾å®ç°ï¼Œä½†æ˜¯ç”±äºå¤§å¤šæ•°ä»£ç éƒ½è€¦åˆåˆ° domain.UserService æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªæ–°çš„å®ç°å¹¶ä½¿ç”¨ã€‚</p>
 <pre class="highlight go"><code><span class="k">package</span> <span class="n">userapi</span>

<span class="k">type</span> <span class="n">UserStore</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">HTTPClient</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Client</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">us</span> <span class="o">*</span><span class="n">UserStore</span><span class="p">)</span> <span class="n">Create</span><span class="p">(</span><span class="n">newUser</span> <span class="n">domain</span><span class="o">.</span><span class="n">NewUser</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">domain</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">domain</span><span class="o">.</span><span class="n">RememberToken</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// interact with a third party API instead of a local SQL database</span>
<span class="p">}</span>

<span class="c">// â€¦</span>
</code></pre> 
<p>ä¸€èˆ¬è€Œè¨€ï¼Œè€¦åˆåˆ°é¢†åŸŸè€Œä¸æ˜¯ç‰¹å®šçš„å®ç°æ–¹å¼ä½¿æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒè¯¸å¦‚ä»¥ä¸‹çš„ç»†èŠ‚ï¼š</p>

<ul>
<li>
<strong>æˆ‘ä»¬æ­£åœ¨ä¸å¾®æœåŠ¡æˆ–æœ¬åœ°æ•°æ®åº“è¿›è¡Œäº¤äº’å—ï¼Ÿ</strong> æ— è®ºæˆ‘ä»¬çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿæ˜¯æœ¬åœ° SQL æ•°æ®åº“è¿˜æ˜¯å¾®æœåŠ¡ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åœ¨åˆç†çš„æ—¶é—´å†…å®Œæˆä»£ç ç¼–å†™ã€‚
<em>**æˆ‘ä»¬æ˜¯å¦é€šè¿‡ JSONï¼ŒGraphQLï¼ŒgRPC æˆ–å…¶ä»–æ–¹å¼ä¸ç”¨æˆ· API é€šä¿¡ï¼Ÿ</em>* å°½ç®¡æˆ‘ä»¬çš„å®ç°éœ€è¦çŸ¥é“å¦‚ä½•ä¸ç”¨æˆ· API è¿›è¡Œé€šä¿¡ï¼Œä½†æ˜¯æ— è®ºæˆ‘ä»¬ä½¿ç”¨å“ªç§ç‰¹å®šæŠ€æœ¯ï¼Œæˆ‘ä»¬å…¶ä½™çš„ä»£ç éƒ½å°†ç»§ç»­ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œã€‚</li>
<li>å…¶ä»–æ›´å¤šâ€¦</li>
</ul>

<p>ä»æ ¹æœ¬ä¸Šè®²ï¼Œè¿™å°±æ˜¯æˆ‘è®¤ä¸ºé¢†åŸŸé©±åŠ¨è®¾è®¡çš„ä¸»è¦å¥½å¤„ã€‚è¿™ä¸æ˜¯èŠ±å“¨çš„æœ¯è¯­ï¼Œè‰²å½©é²œè‰³çš„å›¾å½¢ï¼Œä¹Ÿä¸æ˜¯åœ¨åŒäº‹é¢å‰ç‚«è€€èªæ˜ã€‚çº¯ç²¹æ˜¯è®¾è®¡èƒ½å¤Ÿä¸æ–­å‘å±•ä»¥æ»¡è¶³ä¸æ–­å˜åŒ–çš„éœ€æ±‚çš„è½¯ä»¶ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹ï¼Ÿ">ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹ï¼Ÿ</h2>
<p>æ˜¾è€Œæ˜“è§çš„åç»­é—®é¢˜æ˜¯ï¼šâ€œå¦‚æœå®ƒæ˜¯å¦‚æ­¤å‡ºè‰²ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸åªæ˜¯ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹å‘¢ï¼Ÿâ€</p>

<p>ä»»ä½•æœ‰ä½¿ç”¨æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰ç»éªŒçš„äººéƒ½ä¼šå‘Šè¯‰ä½ ï¼Œå®ƒå¾ˆå®¹æ˜“å‘ç”Ÿç´§å¯†è€¦åˆã€‚å‡ ä¹æˆ‘ä»¬æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½å°†éœ€è¦ä¾èµ–äºæˆ‘ä»¬çš„æ¨¡å‹ï¼Œè€Œæˆ‘ä»¬åªæ˜¯æ¢è®¨äº†è¿™å¯èƒ½ä¼šå¸¦æ¥é—®é¢˜ã€‚é‚£æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ</p>

<p>ä»å…¬ç”¨é¢†åŸŸè¿›è¡Œæ„å»ºè™½ç„¶å¾ˆæœ‰ç”¨ï¼Œä½†å¦‚æœæ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€åœºå™©æ¢¦ã€‚é¢†åŸŸé©±åŠ¨è®¾è®¡å…·æœ‰ç›¸å½“é™¡å³­çš„å­¦ä¹ æ›²çº¿ï¼šå¹¶ä¸æ˜¯å› ä¸ºè¿™äº›æƒ³æ³•ç‰¹åˆ«éš¾äºæŒæ¡ï¼Œè€Œæ˜¯å› ä¸ºåœ¨é¡¹ç›®å‘å±•åˆ°åˆç†è§„æ¨¡ä¹‹å‰ï¼Œä½ å¾ˆå°‘äº†è§£åœ¨åº”ç”¨è¿™äº›æƒ³æ³•æ—¶å“ªé‡Œå‡ºé”™äº†ã€‚ç»“æœæ˜¯å¯èƒ½è¦èŠ±å‡ å¹´çš„æ—¶é—´æ‰èƒ½çœŸæ­£æŒæ¡æ‰€æœ‰æ¶‰åŠçš„åŠ¨æ€æ¼”åŒ–ã€‚æˆ‘å·²ç»å†™äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„è½¯ä»¶äº†ï¼Œä½†æˆ‘ä»ç„¶æ„Ÿè§‰ä¸åˆ°æˆ‘å¯¹æ‰€æœ‰å¯èƒ½å‡ºé”™æˆ–å˜å¾—å¤æ‚çš„æ–¹å¼éƒ½æ‹¥æœ‰å®Œå…¨çš„äº†è§£ã€‚</p>

<p>*æ³¨æ„ï¼šè¿™æ˜¯æˆ‘èŠ±è¿™ä¹ˆé•¿æ—¶é—´å‘å¸ƒæœ¬æ–‡çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚åœ¨å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»ç„¶å¯¹åˆ†äº«ä¿æœ‰ç–‘è™‘ï¼Œæˆ‘ä¸è§‰å¾—è‡ªå·±æ˜¯è¿™ä¸ªä¸»é¢˜çš„ä¸“å®¶ã€‚ä½†æ˜¯ï¼Œæˆ‘æœ€ç»ˆå†³å®šåˆ†äº«ï¼Œå› ä¸ºæˆ‘ç›¸ä¿¡å…¶ä»–äººå¯ä»¥ä»æˆ‘çš„æœ‰é™ç†è§£ä¸­å­¦åˆ°ä¸œè¥¿ï¼Œå¹¶ä¸”æˆ‘ç›¸ä¿¡éšç€ä¸å…¶ä»–å¼€å‘äººå‘˜è¿›è¡Œè®¨è®ºï¼Œæœ¬æ–‡ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•å’Œæ”¹è¿›ã€‚å› æ­¤ï¼Œéšæ—¶æ¬¢è¿ä¸æˆ‘è¿›è¡Œè®¨è®º <a href="mailto:jon@calhoun.io" title="">-jon@calhoun.io</a> *</p>

<p>MVC ä¸ºä½ æä¾›äº†ç»„ç»‡ä»£ç çš„åˆç†èµ·ç‚¹ã€‚æ•°æ®åº“äº¤äº’åœ¨æ¨¡å‹å±‚ï¼Œhttp å¤„ç†ç¨‹åºåœ¨æ§åˆ¶å™¨å±‚ï¼Œæ¸²æŸ“ä»£ç åœ¨è§†å›¾å±‚ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ç´§å¯†è€¦åˆï¼Œä½†å¯ä»¥è®©ä½ å¿«é€Ÿå…¥é—¨ã€‚</p>

<p>ä¸ MVC ä¸åŒï¼Œé¢†åŸŸé©±åŠ¨è®¾è®¡ä¸ä¼šä¸ºä½ æä¾›ç»„ç»‡ä»£ç çš„åˆç†èµ·ç‚¹ã€‚å®é™…ä¸Šï¼Œä» DDD å¼€å§‹ä¸ä» MVC å¼€å§‹å‡ ä¹å®Œå…¨ç›¸åï¼šä¸æ˜¯ç›´æ¥è¿›å…¥æ„å»ºæ§åˆ¶å™¨å¹¶æŸ¥çœ‹æ¨¡å‹å¦‚ä½•å‘å±•ï¼Œç›¸åï¼Œä½ å¿…é¡»èŠ±å¤§é‡æ—¶é—´é¢„å…ˆç¡®å®šé¢†åŸŸåº”è¯¥æ˜¯ä»€ä¹ˆã€‚è¿™å¯èƒ½åŒ…æ‹¬æ¨¡æ‹Ÿä¸€äº›æƒ³æ³•å¹¶è®©åŒäº‹è¿›è¡Œå®¡æŸ¥ï¼Œè®¨è®ºä»€ä¹ˆæ˜¯æ­£ç¡®/ä¸æ­£ç¡®çš„ï¼Œå‡ ä¸ªè¿­ä»£å‘¨æœŸï¼Œç„¶åæ‰å¯ä»¥æŠ•å…¥åˆ°ç¼–å†™ä¸€äº›ä»£ç ä¸­ã€‚ ä½ å¯ä»¥åœ¨ <a href="https://medium.com/wtf-dial/wtf-dial-domain-model-9655cd523182" rel="nofollow" target="_blank" title="">Ben Johnson çš„ WTF Dial é¡¹ç›®</a> ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œä»–åœ¨è¯¥ <a href="https://medium.com/wtf-dial/wtf-dial-domain-model-9655cd523182" rel="nofollow" target="_blank" title="">é¡¹ç›®</a> ä¸­åˆ›å»ºäº† PRï¼Œå¹¶ä¸ Peter Bourgonï¼ŒEgon Elbre å’Œ Marcus Olsson è®¨è®ºäº†é¢†åŸŸç›¸å…³å†…å®¹ã€‚</p>

<p>è¿™å¹¶ä¸æ˜¯ä¸€ä»¶åäº‹ï¼Œä½†æ­£ç¡®èµ·æ¥ä¹Ÿä¸å®¹æ˜“ï¼Œå®ƒéœ€è¦å¤§é‡çš„å‰æœŸå·¥ä½œã€‚ å› æ­¤ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæ›´å¤§çš„å›¢é˜Ÿï¼Œæ¯ä¸ªäººéƒ½éœ€è¦åœ¨æŸä¸ªå…±åŒé¢†åŸŸä¸Šè¾¾æˆå…±è¯†ï¼Œç„¶åæ‰èƒ½å¼€å§‹å¼€å‘ï¼Œé‚£ä¹ˆæˆ‘é€šå¸¸ä¼šå‘ç°è¿™ç§æ–¹æ³•æœ€æœ‰æ•ˆã€‚</p>

<p>é‰´äºæˆ‘ç»å¸¸åœ¨è¾ƒå°çš„å›¢é˜Ÿä¸­ï¼ˆæˆ–ç”±æˆ‘è‡ªå·±ï¼‰è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥æˆ‘å‘ç°ï¼Œå¦‚æœæˆ‘ä»ç®€å•çš„äº‹æƒ…å¼€å§‹ï¼Œæˆ‘çš„é¡¹ç›®å°±ä¼šè‡ªç„¶å‘å±•ã€‚ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ª <a href="https://www.calhoun.io/flat-application-structure/" rel="nofollow" target="_blank" title="">å¹³é“ºç»“æ„</a>  ï¼Œä¹Ÿè®¸æ˜¯ <a href="https://www.calhoun.io/using-mvc-to-structure-go-web-applications/" rel="nofollow" target="_blank" title="">ä¸€ä¸ª mvc ç»“æ„</a>  ï¼Œæˆ–è€…ä¹Ÿè®¸å®Œå…¨æ˜¯å…¶ä»–ä¸œè¥¿ã€‚ åªè¦æˆ‘å¯¹ä»£ç çš„å‘å±•ä¿æŒå¼€æ”¾çš„æ€åº¦ï¼Œæˆ‘å°±ä¸ä¼šå¤ªç€è¿·äºé‚£äº›ç»†èŠ‚ã€‚è¿™ä½¿å®ƒæœ€ç»ˆå¯ä»¥é‡‡ç”¨ DDD ä¹‹ç±»çš„å½¢å¼ï¼Œä½†æ˜¯ä¸éœ€è¦æˆ‘ä»é‚£é‡Œå¼€å§‹ã€‚å¦‚å‰æ‰€è¿°ï¼Œå¯¹äºå¤§å‹ç»„ç»‡ï¼ˆæ¯ä¸ªäººéƒ½ä¸€èµ·å¼€å‘åŒä¸€åº”ç”¨ç¨‹åºï¼‰è€Œè¨€ï¼Œè¿™æ ·åšå¯èƒ½ä¼šæ¯”è¾ƒå›°éš¾ï¼Œå› æ­¤é€šå¸¸éœ€è¦è¿›è¡Œæ›´å¤šçš„å‰æœŸè®¾è®¡è®¨è®ºã€‚ </p>

<p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åšäº†ä¸ â€œè®©å®ƒä¸æ–­å‘å±•â€ çš„æ¦‚å¿µéå¸¸ç›¸ä¼¼çš„äº‹æƒ…ã€‚æ¯ä¸€æ­¥éƒ½æ˜¯ä¸ºç‰¹å®šç›®çš„è€Œé‡‡å–çš„ï¼šæˆ‘ä»¬æ·»åŠ äº†<code>UserService</code>æ¥å£ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æµ‹è¯•èº«ä»½éªŒè¯ä¸­é—´ä»¶ã€‚ å½“æˆ‘ä»¬å¼€å§‹ä» GitHub è¿ç§»åˆ° GitLab æ—¶ï¼Œæˆ‘ä»¬æ„è¯†åˆ°æˆ‘ä»¬çš„æ¥å£ä¸å¤Ÿç”¨ï¼Œå› æ­¤æˆ‘ä»¬æ¢ç´¢äº†å…¶ä»–é€‰æ‹©ã€‚ å›´ç»•è¿™ä¸€ç‚¹ï¼Œæˆ‘è®¤ä¸ºä¸€ç§è®©å˜å¾—æœ‰æ„ä¹‰ DDD çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯çŒœæµ‹<code>User</code>å’Œ<code>UserService</code>æ¥å£ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸€äº›å®é™…çš„å®ç°åŸºç¡€è¿›è¡ŒéªŒè¯ã€‚</p>

<p>ä»¥ DDD å¼€å¤´çš„å¦ä¸€ä¸ªæ½œåœ¨é—®é¢˜æ˜¯ç±»å‹å®šä¹‰ä¸è¶³ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸åœ¨æ‹¥æœ‰å…·ä½“ç”¨ä¾‹ä¹‹å‰å°±å®šä¹‰å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½å†³å®šå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
 <pre class="highlight go"><code><span class="k">type</span> <span class="n">UserAuthenticator</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Authenticate</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">pw</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre> 
<p>ä½†æ˜¯åæ¥ï¼Œæˆ‘ä»¬æ„è¯†åˆ°ï¼Œå®é™…ä¸Šï¼Œæ¯å½“æˆ‘ä»¬å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œæˆ‘ä»¬ç¡®å®å¸Œæœ›è¿”å›è¯¥ç”¨æˆ·ï¼ˆæˆ–è®°ä½çš„ä»¤ç‰Œï¼‰ï¼Œå¹¶ä¸”é€šè¿‡é¢„å…ˆå®šä¹‰æ­¤æ¥å£ï¼Œè€Œä¹‹å‰æˆ‘ä»¬é”™è¿‡äº†è¿™ä¸€ç»†èŠ‚ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ç¬¬äºŒç§æ–¹æ³•æ¥æ£€ç´¢æ­¤ä¿¡æ¯ï¼Œæˆ–è€…æˆ‘ä»¬éœ€è¦æ›´æ”¹<code>UserAuthenticator</code>ç±»å‹å¹¶é‡æ„å®ç°åˆ©ç”¨æ­¤åŠŸèƒ½çš„ä»»ä½•ä»£ç ã€‚</p>

<p>åŒæ ·çš„æƒ…å†µé€‚ç”¨äºä½ çš„æ¨¡å‹ã€‚åœ¨å®é™…å®ç°<code>github</code>å’Œ<code>gitlab</code>è½¯ä»¶åŒ…ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè®¤ä¸ºï¼Œæˆ‘ä»¬åœ¨<code>User</code>æ¨¡å‹ä¸Šå”¯ä¸€éœ€è¦çš„è¯†åˆ«ä¿¡æ¯æ˜¯ Email å­—æ®µï¼Œä½†æ˜¯æˆ‘ä»¬ç¨åå¯èƒ½ä¼šåœ¨å®ç°è¿™äº›æœåŠ¡æ—¶æ„è¯†åˆ°ç”µå­é‚®ä»¶åœ°å€å¯ä»¥æ›´æ”¹çš„ï¼Œè€Œæˆ‘ä»¬è¿˜éœ€è¦ ID å­—æ®µç”¨äºå”¯ä¸€æ ‡è¯†ç”¨æˆ·ã€‚</p>

<p>åœ¨ä½¿ç”¨é¢†åŸŸæ¨¡å‹ä¹‹å‰å®šä¹‰æ˜¯ä¸€é¡¹æŒ‘æˆ˜ã€‚é™¤éæˆ‘ä»¬å·²ç»éå¸¸äº†è§£æˆ‘ä»¬æ­£åœ¨ç ”ç©¶çš„é¢†åŸŸï¼Œå¦åˆ™æˆ‘ä»¬æä¸å¯èƒ½çŸ¥é“æˆ‘ä»¬éœ€è¦åšä»€ä¹ˆå’Œä¸éœ€è¦åšä»€ä¹ˆã€‚æ˜¯çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»åœ¨ä»¥åé‡æ„ä»£ç ï¼Œä½†æ˜¯å¦‚æœä½ é”™è¯¯å®šä¹‰äº†é¢†åŸŸï¼Œä¸ä½¿ç”¨ DDD ä¼šå¾ˆå¤šæ¯”é‡æ„æ•´ä¸ªä»£ç åº“æ›´å®¹æ˜“ã€‚ è¿™æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¸ä»‹æ„ä»ç´§å¯†è€¦åˆçš„ä»£ç å¼€å§‹å¹¶åœ¨ä»¥åè¿›è¡Œé‡æ„çš„å¦ä¸€ä¸ªåŸå› ã€‚</p>

<p>æœ€åï¼Œå¹¶éæ‰€æœ‰ä»£ç éƒ½éœ€è¦è¿™ç§è§£è€¦ï¼Œå®ƒå¹¶ä¸èƒ½æ€»æ˜¯èƒ½å¤Ÿå¸¦æ¥å¥½å¤„ï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚ DBï¼‰ï¼Œæˆ‘ä»¬å¾ˆå°‘åˆ©ç”¨è¿™ç§è§£è€¦ã€‚</p>

<p>å¯¹äºä¸ç»§ç»­ç ”å‘çš„é¡¹ç›®ï¼Œä½ å¯èƒ½ä¸éœ€è¦èŠ±è´¹æ‰€æœ‰æ—¶é—´æ¥è§£è€¦ä»£ç ã€‚å¦‚æœä»£ç æ²¡æœ‰ç»§ç»­ç ”å‘ï¼Œé‚£ä¹ˆæ›´æ”¹çš„å¯èƒ½æ€§å°†å¤§å¤§é™ä½ï¼Œè€Œä¸ºä»£ç åšå‡†å¤‡è€Œä»˜å‡ºçš„é¢å¤–åŠªåŠ›å¯èƒ½åªæ˜¯æµªè´¹äº†ã€‚</p>

<p>æ­¤å¤–ï¼Œè§£è€¦å¹¶ä¸æ€»æ˜¯èƒ½æä¾›å®ƒæ‰€æ‰¿è¯ºçš„å¥½å¤„ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šæ€»æ˜¯åˆ©ç”¨è¿™ç§è§£è€¦çš„ä¼˜åŠ¿ã€‚ æ­£å¦‚<a href="https://twitter.com/matryer" rel="nofollow" target="_blank" title="">Mat Ryer</a>æ‰€æŒ‡å‡ºçš„é‚£æ · ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šæ¢æ‰æ•°æ®åº“å®ç°ã€‚ å³ä½¿æˆ‘ä»¬ç¡®å®å®ç°äº†æ‰€æœ‰åŠŸèƒ½çš„åˆ†ç¦»ï¼Œå³ä½¿æˆ‘ä»¬ç¢°å·§åªåœ¨å°‘æ•°æ­£åœ¨è¿ç§»æ•°æ®åº“çš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™ç§è¿ç§»é€šå¸¸ä¹Ÿéœ€è¦å½»åº•é‡æ–°è€ƒè™‘æˆ‘ä»¬ä¸æ•°æ®å­˜å‚¨ä¹‹é—´çš„äº¤äº’æ–¹å¼ã€‚ æ¯•ç«Ÿï¼ŒNoSQL æ•°æ®åº“çš„è¡Œä¸ºä¸ SQL æ•°æ®åº“å®Œå…¨ä¸åŒï¼Œè¦çœŸæ­£åˆ©ç”¨ä¸¤è€…ï¼Œæˆ‘ä»¬å¿…é¡»ç¼–å†™æ‰€ä½¿ç”¨æ•°æ®åº“çš„ç‰¹å®šä»£ç ã€‚æœ€ç»ˆç»“æœæ˜¯è¿™äº›æŠ½è±¡å¹¶ä¸æ€»æ˜¯ä¸ºæˆ‘ä»¬æä¾›æˆ‘ä»¬æƒ³è¦çš„ç¥å¥‡çš„ â€œå®ç°æ— å…³â€ çš„ç»“æœã€‚</p>

<p>è¿™å¹¶ä¸æ„å‘³ç€ DDD ä¸èƒ½æä¾›ä¼˜åŠ¿ï¼Œè€Œæ˜¯æ„å‘³ç€æˆ‘ä»¬ä¸åº”è¯¥ç®€å•åœ° <a href="https://en.wikipedia.org/wiki/Drinking_the_Kool-Aid" rel="nofollow" target="_blank" title="">é¡¶ç¤¼è†œæ‹œ</a> å¹¶æœŸå¾…ç¥å¥‡æ•ˆæœã€‚æˆ‘ä»¬éœ€è¦åœä¸‹æ¥è‡ªæˆ‘åæ€ã€‚</p>
<h2 id="ç»¼ä¸Šæ‰€è¿°">ç»¼ä¸Šæ‰€è¿°</h2>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ç ”ç©¶äº†ä»£ç ç´§å¯†è€¦åˆæ—¶é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶æ¢è®¨äº†å®šä¹‰é¢†åŸŸç±»å‹å’Œæ¥å£å¦‚ä½•å¸®åŠ©æ”¹å–„è¿™ç§è€¦åˆã€‚ æˆ‘ä»¬è¿˜è®¨è®ºäº†ä¸ºä»€ä¹ˆè®©æˆ‘ä»¬çš„ä»£ç éšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•ï¼Œè€Œä¸æ˜¯ä»å¼€å§‹è¿›è¡Œè¿™ç§åˆ†ç¦»çš„è®¾è®¡çš„åŸå› ã€‚</p>

<p>åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å¸Œæœ›å±•å¼€è®²è§£ä½¿ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ç¼–å†™ Go ä»£ç çš„æƒ³æ³•ã€‚ å…·ä½“æ¥è¯´ï¼Œæˆ‘æƒ³è®¨è®ºï¼š</p>

<ul>
<li>æ¥å£æµ‹è¯•å¦‚ä½•å¸®åŠ©ç¡®ä¿å®ç°å¯ä»¥æ¯«æ— é—®é¢˜åœ°äº’æ¢ã€‚ </li>
<li>å­åŸŸå¦‚ä½•è¡ç”Ÿè‡ªä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚ </li>
<li>ä½¿ç”¨ä¼ ç»Ÿçš„ DDD å…­è¾¹å½¢æ¥å½¢è±¡åŒ–è¿™ä¸€åˆ‡ï¼Œä»¥åŠåƒç¬¬ä¸‰æ–¹åº“è¿™æ ·çš„ä»£ç å¦‚ä½•é€‚é…ã€‚ </li>
</ul>

<p>æˆ‘è¿˜æƒ³å¼ºè°ƒï¼Œæœ¬æ–‡ç»ä¸æ˜¯ç¡¬æ€§è§„å®šã€‚è¿™åªæ˜¯æˆ‘å¾®è–„çš„å°è¯•ï¼Œè¯•å›¾åˆ†äº«ä¸€äº›å¸®åŠ©æˆ‘æ”¹è¿› Go è½¯ä»¶çš„è§è§£å’Œæƒ³æ³•ã€‚</p>

<p>æˆ‘ä¹Ÿä¸æ˜¯ç¬¬ä¸€ä¸ªåœ¨ Go ä¸­è®¨è®ºæˆ–æ¢ç´¢ DDD å’Œè®¾è®¡æ¨¡å¼çš„äººã€‚ ä½ åº”è¯¥æŸ¥çœ‹ä»¥ä¸‹å†…å®¹ä»¥è·å¾—æ›´å…¨é¢çš„ç†è§£ï¼š</p>

<ul>
<li> <a href="https://github.com/marcusolsson/goddd" rel="nofollow" target="_blank" title="">GoDDD by Marcus Olsen</a> - è¿™æ˜¯ä¸€ä¸ª GitHub å­˜å‚¨åº“ï¼Œå…¶ä¸­åŒ…å«æ–‡ç« å’Œæ¼”è®²ï¼ŒMarcus Olsen è¯•å›¾å°†ä¼ ç»Ÿçš„ DDD Java ç¤ºä¾‹åº”ç”¨ç¨‹åºç§»æ¤åˆ° Go ä¸­ã€‚ </li>
<li>  <a href="https://medium.com/wtf-dial" rel="nofollow" target="_blank" title="">WTF Dial by Ben Johnson</a> - æˆ‘åœ¨æ–‡ä¸­é“¾æ¥äº† Ben çš„ Standard Pacakage Layout æ–‡ç« ï¼› æœ¬ç³»åˆ—åº”ç”¨äº† Ben åœ¨è¯¥æ–‡ç« ä¸­è®¨è®ºçš„å†…å®¹ã€‚æˆ‘è¿˜å»ºè®®æŸ¥çœ‹é™„å¸¦çš„ PRï¼Œå¹¶ä»”ç»†é˜…è¯»è¯„è®ºã€‚ </li>
<li> <a href="https://www.youtube.com/watch?v=oL6JBUk6tj0" rel="nofollow" target="_blank" title="">How Do You Structure Your Go Apps by Kat Zien</a> - åœ¨æ¼”è®²ä¸­ï¼ŒKat é€šè¿‡å¤šç§æ–¹æ³•æ„å»ºäº† Go åº”ç”¨ç¨‹åºã€‚é™„å¸¦äº†æ¼”è®²çš„ä»£ç ä»“åº“å’Œå¹»ç¯ç‰‡ã€‚</li>
<li>
<a href="https://www.ardanlabs.com/blog/2017/02/design-philosophy-on-packaging.html" rel="nofollow" target="_blank" title="">Design Philosophy On Packaging by Bill Kennedy</a> - è™½ç„¶ä¸ä¸“é—¨æ¶‰åŠç»“æ„åŒ–åº”ç”¨ç¨‹åºï¼Œä½†æœ¬ç³»åˆ—è®¨è®ºäº†ä¸ç»“æ„ç´§å¯†è”ç³»çš„åŒ…è®¾è®¡ã€‚ </li>
</ul>

<p><em>è½¬è½½è‡ª<a href="https://www.4async.com/2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/" rel="nofollow" target="_blank" title="">åœ¨ Go ä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡</a></em></p>
        
      </div>
      <div class="card-footer clearfix">
        <div class="opts">
    <a title="èµ" data-count="2" data-state="deactive" data-type="Topic" data-id="9779" class="likeable deactive" href="#"><i class='fa fa-heart'></i> <span>2 ä¸ªèµ</span></a>
    
    

  <span class="pull-right opts">

  </span>
</div>

      </div>
    </div>
    
      <div id="replies" class="card" data-last-floor="2">
        <div class="items card-body">
          <div class="reply reply-system" data-id="6859" id="reply1">
  <div id="reply-6859" data-floor="1">
      <a title="kevin (Kevin)" href="/kevin"><img class="media-object avatar-16" src="https://gocn.oss-cn-shanghai.aliyuncs.com/user/avatar/238/32f2aa.jpg?x-oss-process=image/resize,w_32,h_32,m_fill" /></a> <a class="user-name" data-name="Kevin" href="/kevin">kevin</a>
å°†æœ¬å¸–è®¾ä¸ºäº†ç²¾åè´´

<span class='time'>02æœˆ17æ—¥ 08:07</span>

  </div>
</div>
<div class="reply reply-system" data-id="6864" id="reply2">
  <div id="reply-6864" data-floor="2">
      <a title="kevin (Kevin)" href="/kevin"><img class="media-object avatar-16" src="https://gocn.oss-cn-shanghai.aliyuncs.com/user/avatar/238/32f2aa.jpg?x-oss-process=image/resize,w_32,h_32,m_fill" /></a> <a class="user-name" data-name="Kevin" href="/kevin">kevin</a>
åœ¨
<span class='topic'>
  <a title="GoCN æ¯æ—¥æ–°é—» (2020-02-17)" href="/topics/9781">GoCN æ¯æ—¥æ–°é—» (2020-02-17)</a>
</span> ä¸­æåŠäº†æ­¤è´´

<span class='time'>02æœˆ17æ—¥ 10:08</span>

  </div>
</div>

        </div>
      </div>
      <div class="card">
        <div class="card-body">
          <div id="reply" class="form box">
  <div style="padding:20px;" data-turbolinks-action="replace">
    éœ€è¦ <a class="btn btn-primary" href="/account/sign_in">ç™»å½•</a> åæ–¹å¯å›å¤, å¦‚æœä½ è¿˜æ²¡æœ‰è´¦å·è¯·ç‚¹å‡»è¿™é‡Œ <a class="btn btn-danger" href="/account/sign_up">æ³¨å†Œ</a>ã€‚
  </div>
</div>

        </div>
      </div>
          <div class="card">
      <div class="card-header">ç›¸å…³è¯é¢˜</div>
      <ul class="list-group list-group-flush">
          <li class="list-group-item"><a href="/topics/1816">goè¯­è¨€å¦‚ä½•å®ç°pythoné‚£æ ·åœ¨å‰ä¸€æ¬¡è¯·æ±‚ä¸Šä¿ç•™cookieså»è¯·æ±‚</a></li>
          <li class="list-group-item"><a href="/topics/8519">Golang ä¸­ä½¿ç”¨ JSON çš„å°æŠ€å·§</a></li>
          <li class="list-group-item"><a href="/topics/1721">å¤šæ–‡ä»¶å¤šå‚æ•°ä¸Šä¼ ä¸èƒ½è·å–å‚æ•°</a></li>
          <li class="list-group-item"><a href="/topics/8648">å½“go geté‡ä¸Šgitlab</a></li>
          <li class="list-group-item"><a href="/topics/9355">[è¯‘]Goå¦‚ä½•ä¼˜é›…çš„å¤„ç†å¼‚å¸¸</a></li>
      </ul>
    </div>

  </div>
    <div class="sidebar hidden-mobile col-md-3">
      <div id="topic-sidebar" data-spy="affix" data-offset-bottom="65">
  <div class="card">
    <div class="card-body">
      <a href="#" class="btn btn-default btn-block btn-sm btn-move-page" data-type="top"><i class="fa fa-arrow-up"></i></a>
      <div class="buttons">
        <div class="group likes opts">
          <a title="èµ" data-count="2" data-state="deactive" data-type="Topic" data-id="9779" class="likeable deactive" href="#"><i class='fa fa-heart'></i> <span>2 ä¸ªèµ</span></a>
        </div>
        <div class="group">
          <div class="btn-group" role="group">
            
            
          </div>
        </div>
      </div>
      <hr />
      <div class="group">
        <div class='social-share-button' data-title='åœ¨ Go ä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡' data-img=''
data-url='' data-desc='' data-via=''>
<a rel="nofollow " data-site="twitter" class="ssb-icon ssb-twitter" onclick="return SocialShareButton.share(this);" title="åˆ†äº«åˆ° Twitter" href="#"></a>
<a rel="nofollow " data-site="weibo" class="ssb-icon ssb-weibo" onclick="return SocialShareButton.share(this);" title="åˆ†äº«åˆ° æ–°æµªå¾®åš" href="#"></a>
<a rel="nofollow " data-site="facebook" class="ssb-icon ssb-facebook" onclick="return SocialShareButton.share(this);" title="åˆ†äº«åˆ° Facebook" href="#"></a>
<a rel="nofollow " data-site="wechat" class="ssb-icon ssb-wechat" onclick="return SocialShareButton.share(this);" title="åˆ†äº«åˆ° å¾®ä¿¡" data-wechat-footer="æ‰“å¼€å¾®ä¿¡ï¼Œç‚¹å‡»åº•éƒ¨çš„ â€œå‘ç°â€ï¼Œ&lt;br/&gt; ä½¿ç”¨ â€œæ‰«ä¸€æ‰«â€ å³å¯å°†ç½‘é¡µåˆ†äº«è‡³æœ‹å‹åœˆã€‚" href="#"></a>
</div>
      </div>
      <hr />
      <div class="reply-buttons">
        <div class="total">
          å…±æ”¶åˆ° <b>0</b> æ¡å›å¤
        </div>
        <a class="btn btn-success" data-remote="true" href="/kevin/reward"><i class='fa fa-qrcode'></i> <span>æ‰“èµæ”¯æŒ</span></a>
      </div>
      <hr />
      <div class="group opts">

        <div>
        </div>
      </div>
      <a href="#" class="btn btn-default btn-sm btn-block btn-move-page" data-type="bottom"><i class="fa fa-arrow-down"></i></a>
    </div>
  </div>

  <div class="notify-updated">
    <a class="update" href="#"><i class="fa fa-bell-o"></i> <b>æœ‰æ–°å›å¤ï¼</b>ç‚¹å‡»è¿™é‡Œç«‹å³è½½å…¥</a>
  </div>
</div>

    </div>
</div>

  </div>

  <footer class="footer" id="footer" data-turbolinks-permanent>
    <div class="container">
      <div class="container" style="text-align: center;">
      <div class="media" data-turbolinks="false">
  <div class="media-left" style="margin-right:20px;">
    <img class="media-object" src="/uploads/logo.png" style="width: 64px;">
  </div>
  
  <div class="media-body">
    <div class="links">
      <a href="/wiki/about">å…³äº</a> / <a href="http://gopherchina.org" target="_blank" title="Gopher China å¤§ä¼š">GopherChina å¤§ä¼š</a> / <a href="https://goproxy.io" target="_blank" title="é•œåƒ">Go proxy é•œåƒ</a> / <a href="/users">æ´»è·ƒä¼šå‘˜</a> / <a href="/teams">ç»„ç»‡</a> / <a href="https://golang.google.cn/doc/" target="_blank">Go æ–‡æ¡£</a> / <a href="/wiki/contributors">è´¡çŒ®è€…</a>
    </div>
    <div class="copyright">
      ç”±ä¼—å¤šçˆ±å¥½è€…å…±åŒç»´æŠ¤çš„ GoCN ç¤¾åŒºï¼Œæœ¬ç«™ä½¿ç”¨ <a href="https://homeland.ruby-china.org" target="_blank">Homeland</a> æ„å»ºã€‚
    </div>
<div class="supports" style="margin: 10px 0;">
    <span style="margin-right: 20px">æœåŠ¡å™¨ç”± <a href="http://www.ucloud.cn/?utm_source=zanzhu&amp;utm_campaign=gocn&amp;utm_medium=display&amp;utm_content=yejiao&amp;ytag=gocn_logo" target="_blank" rel="twipsy" title="" data-original-title="æœ¬ç«™æœåŠ¡å™¨ç”± UCloud èµåŠ©"><img src="//l.ruby-china.com/photo/2016/e1eb47a05578576bf134da65736cc5b4.png" style="height: 20px; margin-top: -2px"></a> èµåŠ©</span>
   <span> æ²ªICPå¤‡18015863å·-3</span>
   </div>
   <div class="links" style="margin-top:8px">
     <span class="socials">
     <a href="http://github.com/gocn" target="_blank" rel="nofollow" title="æœ¬ç«™åœ¨ GitHub ä¸Šé¢çš„å¼€æºå†…å®¹"><i class="fa fa-github"></i></a>
     <a href="http://twitter.com/astaxie" target="_blank" rel="nofollow" title="æœ¬ç«™çš„ Twitter è´¦å·"><i class="fa fa-twitter"></i></a>
     <a href="https://weibo.com/u/3211200050" target="_blank" rel="nofollow" title="æœ¬ç«™çš„ Weibo è´¦å·"><i class="fa fa-weibo"></i></a>
     <a href="https://www.youtube.com/channel/UCLiAl_5hNOMQdeN0safxV6Q" target="_blank" rel="nofollow" title="æœ¬ç«™åœ¨ YouTube ä¸Šé¢çš„è§†é¢‘å†…å®¹"><i class="fa fa-youtube"></i></a>
     <a href="/topics/feed" target="_blank" rel="nofollow"><i class="fa fa-rss"></i></a>
     </span>

     <a href="?locale=zh-CN" rel="nofollow" style="margin-left: 20px">ç®€ä½“ä¸­æ–‡</a> / <a href="?locale=zh-TW" rel="nofollow">æ­£é«”ä¸­æ–‡</a> / <a href="?locale=en" rel="nofollow">English</a>
   </div>
  </div>
</div>
    </div>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?928280caf87c86e98e74eefae01ebae4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


    </div>
  </footer>

  <script type="text/javascript" data-turbolinks-eval="false">
    App.root_url = "https://gocn.vip/";
    App.asset_url = "https://gocn.oss-cn-shanghai.aliyuncs.com";
    App.twemoji_url = "https://twemoji.ruby-china.com/2";
    App.locale = "zh-CN";
  </script>
    <script type="text/javascript">
    Topics.topic_id = 9779;
    $(document).ready(function(){
    
    })
  </script>

  <script>
    ga('create', '', 'auto');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>
  <div class="zoom-overlay"></div>
</body>
</html>
